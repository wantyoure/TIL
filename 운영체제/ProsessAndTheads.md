프로세스 관련 공부 

프로그램 : 컴퓨터가 실행 할 수 있는 명령어들의 집합체
프로세스 : 컴퓨터에서 실행 중인 프로그램 각각의 프로세스는 독립된 메모리 공간을 할당 받음 
스레드 : 
CPU : 명령어를 실행하는 연산 장치
메인 메모리(메모리) : 프로세스가 CPU에서 실행되기 위해 대기하는 곳
IO(input/output) : 파일을 읽고 쓰거나 네트워크의 어딘가와 데이터를 주고 받는 것
입출력 장치와 데이터를 주거나 받는 것 

초창기
 
단일 프로세스 시스템 : 한번에 하나의 프로그램만 실행됨
단점 : CPU 사용률이 좋지 않음

해결책 : 여러개의 프로그램을 메모리에 올려놓고 동시에 실행시키자!
IO 작업이 발생하면 다른 프로세스가 CPU에서 실행됨

이런 종류의 프로래밍을 멀티프로그래밍으로 말한다.

멀티프로그래밍의 단점 : CPU 사용 시간이 길어지면 다른 프로세스는 계속 대기

해결책: 프로세스는 한번 CPU를 사용할 때 아주 짧은 시간만 CPU에서 실행되도록 하자!
이런 종류의 시스템을 멀티태스킹 이라고 한다. (프로세스의 응답 시간을 최소화 시키는데 목적)

남아있는 아쉬움...
하나의 프로세스가 동시에 여러 작업을 수행하지는 못함

프로세스의 컨텍스트 스위칭은 무거운 작업임

context switching : 프로세스에서 다른 프로세스로 전환 하는 것

프로세스끼리 데이터 공유가 까다로움 왜냐 독립적인 메모리 공간을 할당 받기 때문에

듀얼 코어(CPU)가 등장했는데 잘 쓰고 싶음 

그래서 나온게 쓰레드!!

스레드 특징: 
하나의 프로세스에서 여러개의 작업을 하고 싶었기 때문에 쓰레드가 나옴
1.프로세스는 한개 이상의 스레드 가질 수 있다.
2.CPU에서 실행되는 단위라고 볼 수 있다.
3.같은 프로세스의 스레드들끼리 컨텍스트 스위칭은 가볍다
4.스레드들은 자신들이 속한 프로세스의 메모리 영역을 공유 (데이터 공유가 쉬움)

메모리 구조 비교(싱글 스레드 vs 멀티 스레드) 
사진 구해서 같이 올리자


스레드들은 자원들은 공유하지만 스택은 공유 하지 않음 

멀티스레딩 : 하나의 프로세스가 동시에 여러 작업을 실행하는데 목적

확장된 멀티태스킹 개념 : 여러 프로세스와 여러 스레드가 아주 짧게 쪼개진 cpu time을 나눠 갖는 것 

두개 이상의 프로세서나 코어를 활용하는 시스템을 멀티프로세싱 이라고 함 

컨텍스트 스위칭 : CPU/코어에서 실행 중이던 프로세스/스레드가 다른 프로세스/ 스레드로
교체 되는 것

여기서 말하는 컨텍스트(context)란 무엇인가?

프로세스/스레드의 상태 CPU,메모리 등등 

번외(CPU에 다양한 레지스터 들이 있다.)

컨텍스트 스위칭은 왜 필요한가?
여러 프로세스/스레드를 동시에 실행시키기 위해서

컨텍스트 스위칭은 언제 발생하는가?
주어진 time slice(quantum)를 다 사용 했거나 IO 작업을 해야하거나 다른 리소스를 기다려야 하거나 

컨텍스트 스위칭은 누구에 의해 실행되는가?

OS 커널(kernel) 각종 리소스를 관리/ 감독하는 역할

컨텍스트 스위칭은 구체적으로 어떤 과정으로 일어나는가?

다른 프로세스끼리 스위칭인지 같은 프로세스의 스레드들끼리 스위칭인지에 따라 다르다

다른 프로세스끼리 스위칭 : process context switching
같은 프로세스 스레드들 끼리 스위칭 : thread context switching

둘의 공통점은 무엇인가?
1. 커널 모드에서 실행 (리소스들)
2. CPU의 레지스터 상태를 교체

둘의 차이점은 무엇인가?
같은 프로세스에 속해 있는  스레드 컨텍스트 스위칭은 프로세스의 메모리 영역을 공유 
프로세스간에 프로세스 컨텍스트 스위칭은 가상 메모리 주소 관련 처리를 추가로 수행

스레드 컨텍스트 스위칭이 더 빠른 이유는?

메모리 주소 관련 처리는 하지 않기 때문 

프로세스 컨텍스트 스위칭이 미치는 간접적인 영향은?
캐시에 내가 원하는 정보가 없음, 오염

유저 관점에서 컨텍스트 스위칭이란?
순수한 오버헤드





버스트 관련 공부

CPU : 

버스트 : 어떤 현상이 짧은 시간 안에 집중적으로 일어나는 일

CPU 버스트 : 프로세스가 CPU에서 한번에 연속적으로 실행되는 시간 : 한마디로 길게 쓰는 것 
IO 버스트 : 프로세스가 IO 작업을 요청하고 결과를 기다리는 시간  : 한마디로 길게 쓰는 것 

CPU bound 프로세스 : CPU burst가 많은 프로세스
ex) 동영상 편집 프로그램, 머신러닝 프로그램

IO bound 프로세스 : IO burst가 많은 프로세스
ex) (일반적인)백엔드 API 서버

CPU 버스트를 발생시키는 프로그램을 돌린다고 했을경우
듀얼코어에서 몇개의 쓰레드를 돌리는게 좋을까?

number of CPUs + 1 

IO bound 프로그램은 스레드 몇개로 구현이 적절할까?
여러 상황에 맞춰서 스레드들을 미리 만들어 놓을지 여러 사항을
고려해서 결정하는 것이 필요




동기화, 경쟁조건, 임계영역들

synchronization(동기화) : 여러 프로세스/ 스레드를 동시에 실행해도 공유 데이터의 일관성을 유지하는 것

race condition(경쟁 조건) : 여러 프로세스/스레드가 동시에 같은 데이터를 조작할 때 타이밍이나 접근 순서에 따라 
결과가 달라질 수 있는 상황 

critical section(임계 영역) : 공유 데이터의 일관성을 보장하기 위해 하나의 프로세스/스레드만 진입해서 실행 가능한 영역



어떻게 동기화 시킬 것인가?
한 스레드만 메소드가 종료 될 때 까지 쓰는 것 (임계영역) : critical section


thread-unsafe를 조심하세요

critical section problem의 해결책이 되기 위한 조건 

1. multual exclusion (상호 배제) : 한번에 하나의 프로세스만 가능
2. progress (진행) : 진행이 계속 될 수 있도록
3. bounded waiting(한정된 대기) : 무한정 대기 하면 안 된다.

이걸 다 만족해야지  critical section이 완전한 해결책이 된다.


위에 조건을 어떻게 mutual exclusion을 사용 할 수 있을까?

바로 Lock 이다!

TestAndSet은 CPU atomic 명령어!
- 실행 중간에 간섭받거나 중단되지 않는다
- 같은 메모리 영역에 대해 동시에 실행되지 않는다 



spinLock(스핀락) : 락을 가질 수 있을 때 까지 반복해서 시도 
하지만 기다리는 동안 CPU를 낭비한다는 단점 
이러다간 다 죽어 ㅠㅠ

해결책 : 락이 준비되면 날 깨워 

mutex(뮤텍스) : 락을 가질 수 있을 때 까지 휴식
 
그럼 항상 뮤텍스가 더 좋나? 그건 아니다 
멀티코어 환경이고 critical section에서의 작업이 컨텍스트 스위칭보다 더 빨리 끝난다면
스핀락이 뮤텍스보다 더 이점이 있다 

semaphore(세모포 ) : singal mechanism을 가진, 하나 이상의 프로세스/스레드가 critical section에 
접근 가능하도록 하는 장치

세마포는 순서를 정해줄 때 사용
반드시 같은 프로세스나 스레드 안에서 실행될 필요가 없다



위 까지 공부
-----------------
monitor(모니터)
- mutual exclusion을 보장 (상호 배제)
- 조건에 따라 스레드가 대기(watiting) 상태로 전환 기능

모니터는 언제 사용되나?
- 한번에 하나의 스레드만 실행 돼야 할 때 
- 여러 스레드와 협업(cooperation)이 필요할 때

모니터 구성 요소
- mutex
- condition variable(s)




















 